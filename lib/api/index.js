/**
 *  Copyright 2013-14 Ionică Bizău
 *
 *  A Node.JS module, which provides an object oriented wrapper for the Youtube v3 API.
 *  Author: Ionică Bizău <bizauionica@gmail.com>
 *
 **/

// Dependencies
var ApiMap = require("./api-map");
var Util = require ("./util");

/**
 * methodGenerator
 * Generates API methods
 *
 * @name methodGenerator
 * @function
 * @param {String} api The API name (e.g. activities, channelBanners etc)
 * @param {Object} requestOptions The request options that come from API map
 * @return {Function} The function that is generated by passing the API name and request options
 */
function methodGenerator (api, requestOptions) {
    return function (options, callback) {

        // init self
        var self = this;

        // Create request url and clone request options
        var url = Util.createUrl.apply(self, [api, options]);
        var reqOptions = JSON.parse(JSON.stringify(requestOptions));

        // Attach url field for all requests
        reqOptions.url = url;

        // Handle non-GET requests
        switch (requestOptions.method) {
            case "POST":
                reqOptions.json = options.requestBody;
                break;
            case "PUT":
                console.warn("Not yet implemented");
                break;
            case "DELETE":
                console.warn("Not yet implemented");
                break;
        }

        // Run request
        self.Client.request(reqOptions, callback);
    };
}

module.exports = function () {

    // Initialize self
    var self = this;

    // Each api
    for (var i = 0; i < ApiMap.length; i++) {
        var cApi = ApiMap[i];

        // Initialize the api object
        this[i] = this[i] || {};
        this[i].Client = self;

        // Generate methods
        for (var me in cApi.methods) {
            var cMethod = cApi.methods[i];
            this[i][me] = methodGenerator(api, cMethod.options);
        }
    }
};
